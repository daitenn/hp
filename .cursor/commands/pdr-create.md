# PDR 作成ワークフロー

Product Decision Record (PDR) による意思決定の記録と共有を実現します。

## 使い方

```bash
# GitHub Discussion から PDR を作成
「新しい PDR Discussion を作成してください」

# 技術選定の PDR
「React vs Vue の技術選定について PDR を作成してください。
トレードオフと代替案を含めて記載してください」

# 既存 PDR の更新
「PDR #123 にトレードオフのセクションを追加してください」
```

## 基本例

```bash
# 1. PDR テンプレートを使用して Discussion を作成
「以下の内容で PDR を作成してください：
- タイトル: 状態管理ライブラリの選定
- 対象: フロントエンド アプリケーション
- 課題: 複雑な状態管理の必要性
- 決定事項: Redux Toolkit を採用
- 別の選択肢: Zustand, Recoil とのトレードオフ
- 受け入れるトレードオフ: ボイラープレート コードの増加」
```

## 各セクションの書き方ガイド

### 1. タイトル

```text
意思決定の内容を簡潔に記載する

良い例:
- 状態管理ライブラリの選定
- API 通信ライブラリの変更
- データベース スキーマの設計方針

悪い例:
- 検討事項
- 技術選定について
- 今後の方針
```

### 2. 対象 (in the context of)

何に対する意思決定かを明確化します。

```text
スコープを具体的に記載:

例:
- フロントエンド アプリケーションの状態管理
- ユーザー認証システムの実装
- CI/CD パイプラインの構築
- モバイル アプリの UI フレームワーク
```

### 3. 課題・理想状態 (facing)

直面している課題や、望ましい状態を記載します。

```text
現状の問題点と目指す姿を明確に:

例:
【課題】
- 現在の状態管理が複雑化し、バグの温床になっている
- パフォーマンスのボトルネックが発生している
- 新規メンバーの学習コストが高い

【理想状態】
- シンプルで保守しやすい状態管理
- 高速なレンダリング パフォーマンス
- チーム全体が理解できる設計
```

### 4. 目的・達成事項 (to achieve)

この意思決定により、完全または部分的に何が達成されるかを記載します。

```text
具体的な成果を明示:

例:
- 状態管理のコードを 30% 削減
- レンダリング パフォーマンスを 50% 改善
- 新規メンバーのオンボーディング期間を 2 週間短縮
- 型安全性の向上により、ランタイム エラーを 80% 削減
```

### 5. 決定事項 (we decided for) ※必須

意思決定の内容詳細を記載します。

```text
何を決めたかを具体的に:

例:
Redux Toolkit を状態管理ライブラリとして採用する。

【採用理由】
- TypeScript との統合が優れている
- Redux DevTools による強力なデバッグ機能
- 豊富なエコシステムとコミュニティ サポート
- チーム メンバーの既存知識を活用できる

【実装方針】
- RTK Query を使用した API 通信の統一
- createSlice による簡潔な Reducer 定義
- Redux Toolkit のベスト プラクティスに準拠
```

### 6. 別の選択肢 (and neglected) ※技術選定時は必須

選ばれなかった選択肢とそれらの欠点を記載します。

**技術選定時のトレードオフ分析を必ず含めてください。**

```text
代替案との比較を明確に:

例:
【Zustand】
✅ 利点:
- 学習コストが低い
- ボイラープレート コードが少ない
- 軽量でシンプルな API

❌ 欠点:
- DevTools のサポートが限定的
- 大規模アプリケーションでの実績が少ない
- TypeScript 型推論が弱い

【Recoil】
✅ 利点:
- React の思想に沿った設計
- 細かい粒度での状態管理が可能
- 優れたパフォーマンス最適化

❌ 欠点:
- Meta 製だが experimental ステータス
- エコシステムが限定的
- ドキュメントが不十分

【Context API + useReducer】
✅ 利点:
- 追加ライブラリ不要
- React 標準機能のみで完結

❌ 欠点:
- パフォーマンス最適化が困難
- デバッグ ツールがない
- 大規模アプリケーションには不向き
```

### 7. 受け入れるトレードオフ (accepting downside)

この意思決定により生まれる(可能性のある)ネガティブな副作用を記載します。

**デメリットを正直に記載することが重要です。**

```text
受け入れる制約を明示:

例:
【ボイラープレート コードの増加】
- Zustand と比較して約 30% のコード量増加
- Store 設定やスライス定義に初期コストが発生

【学習コスト】
- Redux の概念理解に 1-2 週間が必要
- 新規メンバーのオンボーディング期間が延びる可能性

【バンドル サイズ】
- Redux Toolkit + 依存関係で約 50KB の増加
- モバイル環境での初期ロード時間への影響

【移行コスト】
- 既存の Context API からの移行に 2-3 スプリント必要
- 段階的移行中の混在期間が発生
```

## 技術選定の例

### データベース選定の PDR

```markdown
## タイトル: プロジェクト データベースの選定

### 対象 (in the context of)

新規 SaaS プロダクトのバックエンド システム

### 課題・理想状態 (facing)

【課題】
- 複雑なリレーション データの管理が必要
- 将来的なスケーラビリティの確保
- トランザクション整合性の保証

【理想状態】
- 高速なクエリ パフォーマンス
- 開発者フレンドリーな DX
- 運用コストの最適化

### 目的・達成事項 (to achieve)

- データ整合性の 100% 保証
- 99.9% 以上の可用性確保
- 開発速度の向上

### 決定事項 (we decided for)

PostgreSQL を採用する。

【採用理由】
- ACID トランザクションの完全サポート
- JSON 型による柔軟なスキーマ設計
- 豊富な拡張機能とツール エコシステム
- チーム メンバーの知見が豊富

### 別の選択肢 (and neglected)

**MySQL**
✅ 利点:
- 広く採用されており情報が豊富
- シンプルな運用
- レプリケーション設定が容易

❌ 欠点:
- JSON サポートが PostgreSQL より弱い
- 複雑なクエリのパフォーマンスが劣る
- トランザクション分離レベルの制限

**MongoDB**
✅ 利点:
- スキーマレスで柔軟な開発
- 水平スケーリングが容易
- JSON ネイティブ

❌ 欠点:
- リレーション データの扱いが複雑
- トランザクション サポートが限定的
- 結果整合性モデルがアプリケーション要件に合わない

### 受け入れるトレードオフ (accepting downside)

【運用の複雑性】
- MongoDB と比較してスケーリングが複雑
- バーティカル スケーリング中心の設計

【学習コスト】
- SQL チューニングの専門知識が必要
- インデックス設計の習熟に時間が必要

【初期セットアップ】
- レプリケーション構成の設定コスト
- バックアップ戦略の策定が必要
```

## ベストプラクティス

### 1. 客観的な比較

```text
❌ 悪い例:
「Redux は最高のライブラリなので採用する」

✅ 良い例:
「Redux Toolkit は以下の理由で採用する:
- TypeScript サポート: 型推論が優れている
- DevTools: 時間旅行デバッグが可能
- エコシステム: 豊富なミドルウェアと統合」
```

### 2. 定量的なトレードオフ

```text
❌ 悪い例:
「パフォーマンスが悪くなる可能性がある」

✅ 良い例:
「初期バンドル サイズが約 50KB 増加し、
モバイル 3G 環境で約 0.5 秒の読み込み遅延が発生する可能性」
```

### 3. 将来の見直し条件

```text
以下の場合、決定を再検討する:
- 月間アクティブ ユーザーが 100 万を超えた場合
- バンドル サイズが 500KB を超えた場合
- チーム サイズが 20 人を超えた場合
```

### 4. 影響範囲の明示

```text
【影響を受けるチーム/システム】
- フロントエンド チーム: 全員が学習必要
- バックエンド チーム: API 設計への影響なし
- QA チーム: テスト戦略の見直し必要
```

## 実行手順

### 1. GitHub Discussion での PDR 作成

```bash
# 方法 A: GitHub CLI
gh api repos/{owner}/{repo}/discussions \
  --method POST \
  --field title="状態管理ライブラリの選定" \
  --field body="PDR テンプレートの内容" \
  --field category_id="PDR のカテゴリ ID"

# 方法 B: Web UI
# 1. GitHub リポジトリの Discussions タブへ移動
# 2. "New discussion" をクリック
# 3. カテゴリから "PDR" を選択
# 4. テンプレートに従って記入
```

### 2. ラベル付与

```bash
# PDR に適切なラベルを付与
gh api repos/{owner}/{repo}/discussions/{discussion_number}/labels \
  --method POST \
  --field labels[]="pdr" \
  --field labels[]="tech-decision"
```

### 3. レビュー プロセス

```text
1. Draft として作成
2. 関係者にレビュー依頼
3. フィードバックを反映
4. 最終承認後に確定
```

## 注意事項

### トレードオフの誠実な記載

- **すべての決定にトレードオフがある**: デメリットがない選択肢は存在しない
- **正直に記載する**: 後で問題になるより、事前に共有する
- **定量的に評価する**: 可能な限り数値で示す

### 技術選定時の必須項目

- **別の選択肢**: 最低 2 つ以上の代替案を比較
- **トレードオフ**: 各選択肢の利点と欠点を明示
- **受け入れるデメリット**: 選択したソリューションの制約を記載

### 継続的な見直し

- PDR は一度書いたら終わりではない
- 状況変化に応じて更新する
- 見直し条件を明確にしておく
